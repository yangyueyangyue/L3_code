%% 最小二乘
omega_e0_rpm=[700,800,900,1000,1100,1200,1300,1400,1500,1600,1700,1800];
omega_e_rpm=omega_e0_rpm';
for i=1:9-1
    omega_e_rpm=[omega_e_rpm omega_e0_rpm'];
end
throttle=[0.02,0.1,0.2,0.4,0.5,0.6,0.7,0.95,1];
T_e=[
0 552 954 1758 2102 2394 2685 3100 3100
-50	452	854	1658 2002 2294 2585 3000 3000
-100 352 754 1558 1902 2194 2485 2900 2900
-150 252 654 1458 1802 2094 2385 2800 2800
-150 252 654 1458 1802 2094 2385 2800 2800
-150 252 654 1458 1802 2094 2385 2800 2800
-150 252 654 1458 1802 2094 2385 2800 2800
-270 132 534 1338 1682 1974 2265 2800 2800
-390 12	414	1218 1562 1854 2145 2710 2710
-510 -108 294 1098 1442 1734 2025 2620 2620
-630 -228 174 978 1322 1614 1905 2530 2530
-750 -348 54 858 1202 1494 1785 2440 2440];
% P_e=;
F_r=[
0	0.00221675	0.003752843	0.0073	0.008985952	0.010419836	0.011848808	0.013886691	0.013886691
0.000189661	0.002141176	0.003808752	0.007974108	0.009205126	0.010711121	0.012211958	0.014352327	0.014352327
0.000027129	0.001970371	0.002634167	0.007739919	0.009477566	0.010964881	0.012489064	0.014677006	0.014677006
0 0.001723279 0.003704884 0.007943028 0.00980889	0.011373204	0.012939008	0.015318364 0.015318364
0 0.001925439 0.004086504 0.008650279 0.010647242 0.012352333 0.01406879	0.016708031 0.016708031
0 0.002140753 0.004484583 0.009390742 0.01154886	0.013412304	0.015314352	0.018264231 0.018264231
0 0.002367013 0.004883922 0.010166834 0.012488323 0.01457238	0.016745883	0.020133918	0.020133918
0 0.001834488 0.004490567 0.010121586 0.01262221	0.014860942	0.017235664	0.022681088	0.022681088
0 0.00120964	0.004019737	0.009977396	0.012648744	0.015015192	0.017503463	0.026715914	0.026715914
0 0.000485243 0.003468636 0.009786132 0.012628775 0.015160226 0.017819148 0.024375867 0.024375867
0 0 0.002832668 0.009541179 0.012584736 0.015290018 0.018108753  0.025235698 0.025235698
0 0 0.002124122 0.009171995 0.012439473 0.015320118 0.018340264 0.026545849 0.026545849];%kg/s
F_r=F_r(:)*1000;%g/s
omega_e_rpm=omega_e_rpm(:);%rpm
T_e=T_e(:);%N*m
% 燃油消耗率二次多项式拟合模型：mf=L00+L01*N+L02*(N^2)+L10*Te+L11*Te*N+L12*Te*(N^2)+L_0*(Te^2)+L21*(Te^2)*N+L22*(Te^2)*(N^2)
% X=[ones(size(F_r)) omega_e_rpm omega_e_rpm.^2 T_e T_e.*omega_e_rpm T_e.*omega_e_rpm.^2 T_e.^2 T_e.^2.*omega_e_rpm T_e.^2.*omega_e_rpm.^2];
syms L00 L01 L02 L10 L11 L12 L20 L21 L22
CC=(F_r-(L00*ones(size(F_r))+L01*omega_e_rpm+L02*omega_e_rpm.^2+L10*T_e+L11*T_e.*omega_e_rpm+L12*T_e.*omega_e_rpm.^2+L20*T_e.^2+L21*T_e.^2.*omega_e_rpm+L22*T_e.^2.*omega_e_rpm.^2)).^2;
C=sum(CC);
eqn=[diff(C,L00)==0,diff(C,L01)==0,diff(C,L02)==0,diff(C,L10)==0,diff(C,L11)==0,diff(C,L12)==0,diff(C,L20)==0,diff(C,L21)==0,diff(C,L22)==0];
[L00,L01,L02,L10,L11,L12,L20,L21,L22]=solve(eqn,[L00 L01 L02 L10 L11 L12 L20 L21 L22]);
L00=double(L00);
b1=[L00,L01,L02,L10,L11,L12,L20,L21,L22];
b=zeros(1,length(b1));
for i=1:length(b1)
    b(i)=double(b1(1,i));
end

% %% 最小二乘
% omega_e0_rpm=[700,800,900,1000,1100,1200,1300,1400,1500,1600,1700,1800];
% omega_e_rpm=omega_e0_rpm';
% for i=1:9-1
%     omega_e_rpm=[omega_e_rpm omega_e0_rpm'];
% end
% throttle=[0.02,0.1,0.2,0.4,0.5,0.6,0.7,0.95,1];
% T_e=[
% 0 552 954 1758 2102 2394 2685 3100 3100
% -50	452	854	1658 2002 2294 2585 3000 3000
% -100 352 754 1558 1902 2194 2485 2900 2900
% -150 252 654 1458 1802 2094 2385 2800 2800
% -150 252 654 1458 1802 2094 2385 2800 2800
% -150 252 654 1458 1802 2094 2385 2800 2800
% -150 252 654 1458 1802 2094 2385 2800 2800
% -270 132 534 1338 1682 1974 2265 2800 2800
% -390 12	414	1218 1562 1854 2145 2710 2710
% -510 -108 294 1098 1442 1734 2025 2620 2620
% -630 -228 174 978 1322 1614 1905 2530 2530
% -750 -348 54 858 1202 1494 1785 2440 2440];
% % P_e=;
% F_r=[
% 0	0.00221675	0.003752843	0.0073	0.008985952	0.010419836	0.011848808	0.013886691	0.013886691
% 0.000189661	0.002141176	0.003808752	0.007974108	0.009205126	0.010711121	0.012211958	0.014352327	0.014352327
% 0.000027129	0.001970371	0.002634167	0.007739919	0.009477566	0.010964881	0.012489064	0.014677006	0.014677006
% -0.000181547 0.001723279 0.003704884 0.007943028 0.00980889	0.011373204	0.012939008	0.015318364 0.015318364
% -0.000140916 0.001925439 0.004086504 0.008650279 0.010647242 0.012352333 0.01406879	0.016708031 0.016708031
% -0.000100079 0.002140753 0.004484583 0.009390742 0.01154886	0.013412304	0.015314352	0.018264231 0.018264231
% -0.000048161 0.002367013 0.004883922 0.010166834 0.012488323 0.01457238	0.016745883	0.020133918	0.020133918
% -0.000750407 0.001834488 0.004490567 0.010121586 0.01262221	0.014860942	0.017235664	0.022681088	0.022681088
% -0.001561406 0.00120964	0.004019737	0.009977396	0.012648744	0.015015192	0.017503463	0.026715914	0.026715914
% -0.002489634 0.000485243 0.003468636 0.009786132 0.012628775 0.015160226 0.017819148 0.024375867 0.024375867
% -0.003526582 -0.000346957 0.002832668 0.009541179 0.012584736 0.015290018 0.018108753  0.025235698 0.025235698
% -0.004505761 -0.001190819 0.002124122 0.009171995 0.012439473 0.015320118 0.018340264 0.026545849 0.026545849];%kg/s
% F_r=F_r(:)*1000;%g/s
% omega_e_rpm=omega_e_rpm(:);%rpm
% T_e=T_e(:);%N*m
% % 燃油消耗率二次多项式拟合模型：mf=L00+L01*N+L02*(N^2)+L10*Te+L11*Te*N+L12*Te*(N^2)+L_0*(Te^2)+L21*(Te^2)*N+L22*(Te^2)*(N^2)
% % X=[ones(size(F_r)) omega_e_rpm omega_e_rpm.^2 T_e T_e.*omega_e_rpm T_e.*omega_e_rpm.^2 T_e.^2 T_e.^2.*omega_e_rpm T_e.^2.*omega_e_rpm.^2];
% syms L00 L01 L02 L10 L11 L12 L20 L21 L22
% CC=(F_r-(L00*ones(size(F_r))+L01*omega_e_rpm+L02*omega_e_rpm.^2+L10*T_e+L11*T_e.*omega_e_rpm+L12*T_e.*omega_e_rpm.^2+L20*T_e.^2+L21*T_e.^2.*omega_e_rpm+L22*T_e.^2.*omega_e_rpm.^2)).^2;
% C=sum(CC);
% eqn=[diff(C,L00)==0,diff(C,L01)==0,diff(C,L02)==0,diff(C,L10)==0,diff(C,L11)==0,diff(C,L12)==0,diff(C,L20)==0,diff(C,L21)==0,diff(C,L22)==0];
% [L00,L01,L02,L10,L11,L12,L20,L21,L22]=solve(eqn,[L00 L01 L02 L10 L11 L12 L20 L21 L22]);
% L00=double(L00);
% b1=[L00,L01,L02,L10,L11,L12,L20,L21,L22];
% b=zeros(1,length(b1));
% for i=1:length(b1)
%     b(i)=double(b1(1,i));
% end



% %% 最小二乘
% 该程序
% omega_e0_rpm=[600,700,800,900,1000,1100,1200,1300,1400,1500,1600,1700,1800];
% omega_e_rpm=omega_e0_rpm';
% for i=1:9-1
%     omega_e_rpm=[omega_e_rpm omega_e0_rpm'];
% end
% throttle=[0.02,0.1,0.2,0.4,0.5,0.6,0.7,0.95,1];
% T_e=[
% 50	652	1000	1000	1000	1000	1000	1000	1000
% 0	552	954	1670	1670	1670	1670	1670	1670
% -50	452	854	1658	2002	2100	2100	2100	2100
% -100	352	754	1558	1902	2194	2485	2500	2500
% -150	252	654	1458	1802	2094	2385	2650	2650
% -150	252	654	1458	1802	2094	2385	2650	2650
% -150	252	654	1458	1802	2094	2385	2650	2650
% -150	252	654	1458	1802	2094	2385	2650	2650
% -270	132	534	1338	1682	1974	2265	2650	2650
% -390	12	414	1218	1562	1854	2145	2650	2650
% -400	-108	294	1098	1442	1734	2025	2494	2494
% -400	-228	174	978	1322	1614	1905	2347	2347
% -400	-348	54	858	1202	1494	1785	2217	2217
% ];
% % P_e=;
% F_r=[
% 0	0.0022188	0.0036134	0.0036134	0.0036134	0.0036134	0.0036134	0.0036134	0.0036134
% 0	0.0021566	0.003842	0.0069899	0.0069899	0.0069899	0.0069899	0.0069899	0.0069899
% 0	0.0020564	0.0038296	0.0075436	0.009201	0.0096806	0.0096806	0.0096806	0.0096806
% 0	0.0019093	0.0037839	0.0077091	0.0094603	0.010981	0.012526	0.012607	0.012607
% 0	0.0017085	0.0036935	0.007866	0.0097337	0.011358	0.013012	0.014549	0.014549
% 0	0.0019641	0.0040848	0.0085727	0.010593	0.012355	0.014155	0.015831	0.015831
% 5.46e-05	0.0022189	0.0044859	0.009328	0.011525	0.013449	0.01542	0.017262	0.017262
% 0.00017829	0.002473	0.0048969	0.010132	0.01253	0.014639	0.016809	0.018844	0.018844
% 0	0.0019842	0.0045272	0.010098	0.012679	0.014962	0.017322	0.020575	0.020575
% 0	0.0014209	0.0040709	0.0099703	0.012738	0.015203	0.017764	0.022457	0.022457
% 0	0.00078905	0.0035284	0.0097391	0.012694	0.015343	0.018111	0.022841	0.022841
% 0	9.75e-05	0.0029034	0.0093974	0.012535	0.015367	0.018345	0.023161	0.023161
% 0	0	0.0022027	0.0089414	0.012252	0.015264	0.018449	0.023515	0.023515
% ];%kg/s
% F_r=F_r(:)*1000;%g/s
% omega_e_rpm=omega_e_rpm(:);%rpm
% T_e=T_e(:);%N*m
% % 燃油消耗率二次多项式拟合模型：mf=L00+L01*N+L02*(N^2)+L10*Te+L11*Te*N+L12*Te*(N^2)+L_0*(Te^2)+L21*(Te^2)*N+L22*(Te^2)*(N^2)
% % X=[ones(size(F_r)) omega_e_rpm omega_e_rpm.^2 T_e T_e.*omega_e_rpm T_e.*omega_e_rpm.^2 T_e.^2 T_e.^2.*omega_e_rpm T_e.^2.*omega_e_rpm.^2];
% syms L00 L01 L02 L10 L11 L12 L20 L21 L22
% CC=(F_r-(L00*ones(size(F_r))+L01*omega_e_rpm+L02*omega_e_rpm.^2+L10*T_e+L11*T_e.*omega_e_rpm+L12*T_e.*omega_e_rpm.^2+L20*T_e.^2+L21*T_e.^2.*omega_e_rpm+L22*T_e.^2.*omega_e_rpm.^2)).^2;
% C=sum(CC);
% eqn=[diff(C,L00)==0,diff(C,L01)==0,diff(C,L02)==0,diff(C,L10)==0,diff(C,L11)==0,diff(C,L12)==0,diff(C,L20)==0,diff(C,L21)==0,diff(C,L22)==0];
% [L00,L01,L02,L10,L11,L12,L20,L21,L22]=solve(eqn,[L00 L01 L02 L10 L11 L12 L20 L21 L22]);
% L00=double(L00);
% b1=[L00,L01,L02,L10,L11,L12,L20,L21,L22];
% b=zeros(1,length(b1));
% for i=1:length(b1)
%     b(i)=double(b1(1,i));
% end





% %% 最小二乘
% 该程序
% omega_e0_rpm=[600,700,800,900,1000,1100,1200,1300,1400,1500,1600,1700,1800];
% omega_e_rpm=omega_e0_rpm';
% for i=1:9-1
%     omega_e_rpm=[omega_e_rpm omega_e0_rpm'];
% end
% throttle=[0.02,0.1,0.2,0.4,0.5,0.6,0.7,0.95,1];
% T_e=[
% 50	652	1000	1000	1000	1000	1000	1000	1000
% 0	552	954	1670	1670	1670	1670	1670	1670
% -50	452	854	1658	2002	2100	2100	2100	2100
% -100	352	754	1558	1902	2194	2485	2500	2500
% -150	252	654	1458	1802	2094	2385	2650	2650
% -150	252	654	1458	1802	2094	2385	2650	2650
% -150	252	654	1458	1802	2094	2385	2650	2650
% -150	252	654	1458	1802	2094	2385	2650	2650
% -270	132	534	1338	1682	1974	2265	2650	2650
% -390	12	414	1218	1562	1854	2145	2650	2650
% -400	-108	294	1098	1442	1734	2025	2494	2494
% -400	-228	174	978	1322	1614	1905	2347	2347
% -400	-348	54	858	1202	1494	1785	2217	2217
% ];
% % P_e=;
% F_r=[
% 0	0.0022188	0.0036134	0.0036134	0.0036134	0.0036134	0.0036134	0.0036134	0.0036134
% 0	0.0021566	0.003842	0.0069899	0.0069899	0.0069899	0.0069899	0.0069899	0.0069899
% 0	0.0020564	0.0038296	0.0075436	0.009201	0.0096806	0.0096806	0.0096806	0.0096806
% 0	0.0019093	0.0037839	0.0077091	0.0094603	0.010981	0.012526	0.012607	0.012607
% 0	0.0017085	0.0036935	0.007866	0.0097337	0.011358	0.013012	0.014549	0.014549
% 0	0.0019641	0.0040848	0.0085727	0.010593	0.012355	0.014155	0.015831	0.015831
% 5.46e-05	0.0022189	0.0044859	0.009328	0.011525	0.013449	0.01542	0.017262	0.017262
% 0.00017829	0.002473	0.0048969	0.010132	0.01253	0.014639	0.016809	0.018844	0.018844
% 0	0.0019842	0.0045272	0.010098	0.012679	0.014962	0.017322	0.020575	0.020575
% 0	0.0014209	0.0040709	0.0099703	0.012738	0.015203	0.017764	0.022457	0.022457
% 0	0.00078905	0.0035284	0.0097391	0.012694	0.015343	0.018111	0.022841	0.022841
% 0	9.75e-05	0.0029034	0.0093974	0.012535	0.015367	0.018345	0.023161	0.023161
% 0	0	0.0022027	0.0089414	0.012252	0.015264	0.018449	0.023515	0.023515
% ];%kg/s
% F_r=F_r(:)*1000;%g/s
% omega_e_rpm=omega_e_rpm(:);%rpm
% T_e=T_e(:);%N*m
% % 燃油消耗率二次多项式拟合模型：mf=L00+L01*N+L02*(N^2)+L10*Te+L11*Te*N+L12*Te*(N^2)+L_0*(Te^2)+L21*(Te^2)*N+L22*(Te^2)*(N^2)
% % X=[ones(size(F_r)) omega_e_rpm omega_e_rpm.^2 T_e T_e.*omega_e_rpm T_e.*omega_e_rpm.^2 T_e.^2 T_e.^2.*omega_e_rpm T_e.^2.*omega_e_rpm.^2];
% syms L00 L01 L02 L10 L11 L12 L20 L21 L22
% CC=(F_r-(L00*ones(size(F_r))+L01*omega_e_rpm+L02*omega_e_rpm.^2+L10*T_e+L11*T_e.*omega_e_rpm+L12*T_e.*omega_e_rpm.^2+L20*T_e.^2+L21*T_e.^2.*omega_e_rpm+L22*T_e.^2.*omega_e_rpm.^2)).^2;
% C=sum(CC);
% eqn=[diff(C,L00)==0,diff(C,L01)==0,diff(C,L02)==0,diff(C,L10)==0,diff(C,L11)==0,diff(C,L12)==0,diff(C,L20)==0,diff(C,L21)==0,diff(C,L22)==0];
% [L00,L01,L02,L10,L11,L12,L20,L21,L22]=solve(eqn,[L00 L01 L02 L10 L11 L12 L20 L21 L22]);
% L00=double(L00);
% b1=[L00,L01,L02,L10,L11,L12,L20,L21,L22];
% b=zeros(1,length(b1));
% for i=1:length(b1)
%     b(i)=double(b1(1,i));
% end




